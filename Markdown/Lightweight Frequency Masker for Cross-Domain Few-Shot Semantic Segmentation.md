# 跨域少样本语义分割的轻量级频率掩码器

**作者：** 童金涛，邹一雄*，李雨华，李瑞轩  
**单位：** 华中科技大学计算机科学与技术学院  
**邮箱：** {jintaotong, yixiongz, idcliyuhua, rxli}@hust.edu.cn

---

## 摘要

跨域少样本分割(CD-FSS)旨在首先在大规模源域数据集上预训练模型，然后将模型迁移到数据稀缺的目标域数据集进行像素级分割。源域和目标域数据集之间的显著域差距导致现有少样本分割(FSS)方法在跨域场景中的性能急剧下降。在这项工作中，我们发现了一个有趣的现象：简单地为目标域过滤不同的频率分量可以显著提高性能，有时甚至高达14% mIoU。然后，我们深入研究这一现象进行解释，发现这种改进源于特征图中通道间相关性的降低，这有利于CD-FSS增强对域差距的鲁棒性和更大的分割激活区域。基于此，我们提出了一个轻量级频率掩码器，通过振幅-相位掩码器(APM)模块和自适应通道相位注意力(ACPA)模块进一步降低通道相关性。值得注意的是，APM仅引入0.01%的额外参数，但平均性能提升超过10%，ACPA仅导入2.5%的参数，但进一步提升性能超过1.5%，显著超越了最先进的CD-FSS方法。

## 1. 引言

语义分割的最新进展得益于大规模标注数据集和深度神经网络的发展[8, 29, 50, 44]。然而，对大量标注数据的需求仍然是一个重大挑战，特别是对于语义分割等密集预测任务。因此，少样本语义分割(FSS)[35, 11, 49]被提出来应对这一挑战，旨在仅使用有限的标注数据为未见类别产生预测。然而，当面临域偏移时，特别是当新类别(目标域)和基础类别(源域)之间存在显著差距时，这些FSS方法表现不佳。这个问题催生了跨域少样本语义分割(CD-FSS)任务[24]的发展。尽管在CD-FSS方面做出了各种努力，但结果仍然不尽如人意。

为了处理域偏移问题，人们努力研究神经网络的泛化性。最近，一些工作[42, 40, 7]从频域的角度探索了这一点，取得了理论突破。与人类相比，神经网络对不同频率分量表现出更高的敏感性。此外，振幅和相位表现出不同的性质并对神经网络性能产生不同影响。受这些工作启发，我们从频域的角度研究域偏移问题，发现了图1所示的有趣现象：对于已经在源域上训练的模型，在测试期间简单地过滤图像的频率分量就能显著提升性能，有时甚至高达14% mIoU。

**图1：** 对于已经在源域上训练的模型，我们简单地过滤掉不同的频率分量并绘制mIoU与保留的图像分量的关系图。P表示相位，A表示振幅，H表示高频，L表示低频。我们可以看到，与基线(Ax, Px)相比，大多数情况下性能都有显著提升，在胸部X光数据集上甚至高达14%(ALx, Px)。在本文中，我们深入研究这一现象进行解释，并提出了用于高效跨域少样本分割的轻量级频率掩码器。

在本文中，我们深入研究这一现象进行解释。通过实验和数学推导，我们发现对相位和振幅的过滤有效地解耦了特征通道，降低了通道相关性，帮助模型捕获更大范围的语义模式。这有利于模型提高对大域差距的鲁棒性，并有助于发现整个对象进行分割。

基于上述解释，我们提出了用于CD-FSS任务的轻量级频率掩码器。该掩码器不需要在源域上训练，可以在目标域微调期间直接插入到中间特征图中。它包括振幅-相位掩码器(APM)模块和自适应通道相位注意力(ACPA)模块。APM在目标域上自适应学习，以更细的粒度过滤掉有害的振幅和相位分量，提高通道解耦的有效性。ACPA通过相位信息学习通道上的注意力。值得注意的是，APM模块仅引入0.01%的额外参数，但可以有效地平均提升mIoU超过10%，ACPA进一步提升平均性能1.5%，仅引入2.5%的额外参数。

**总之，我们的贡献可以列举如下：**

- 我们发现了一个现象：在目标域上简单过滤频率分量可以显著提升性能，最高改进接近14%。

- 我们深入研究这一现象进行解释。我们发现频率过滤操作可以有效解耦特征图通道，有利于模型提高对大域差距的鲁棒性和更大范围的感兴趣区域发现。

- 基于我们的解释，我们提出了用于CD-FSS任务的轻量级频率掩码器，在仅引入2.5%参数的情况下平均显著提升mIoU 11%。

- 在四个目标数据集上的大量实验表明，我们的工作通过简单有效的设计，显著优于最先进的CD-FSS方法。

## 2. 频率过滤增强性能的解释

在本节中，我们深入研究为什么在某些目标域中过滤某些频率分量可以显著提升CD-FSS性能。

### 2.1 预备知识

跨域少样本语义分割(CD-FSS)旨在将从有充足训练标签的源域获得的知识推广到未见的目标域。给定源域 $D_s = (X_s, Y_s)$ 和目标域 $D_t = (X_t, Y_t)$，其中 $X$ 表示输入数据分布，$Y$ 表示标签空间。模型将在来自 $D_s$ 的训练集上训练，然后应用于 $D_t$ 中新类别的分割。值得注意的是，$D_s$ 和 $D_t$ 表现出不同的输入数据分布，它们各自的标签空间没有交集，即 $X_s \neq X_t$，$Y_s \cap Y_t = \emptyset$。

在这项工作中，我们采用片段训练方式。具体来说，从 $D_s$ 采样的训练集和从 $D_t$ 采样的测试集都由几个片段组成，每个片段由K个支持样本 $S = \{I_s^i, M_s^i\}_{i=1}^K$ 和一个查询 $Q = \{I^q, M^q\}$ 构成(I是图像，M是标签)。在每个片段内，模型期望使用 $\{I^s, M^s\}$ 和 $I^q$ 来预测查询标签。

### 2.2 增强性能源于通道间相关性的降低

现有研究表明通道间关系对性能至关重要，因为不同的特征通道可以表示不同的特征[3, 30]。因此，我们研究频率过滤带来的通道相关性变化。具体来说，我们测量了来自骨干网络最后一层的通道间平均互信息(MI)[4]。测量的案例包括图1中最高和最低性能的相位和振幅组合。我们在表1中报告了1-shot mIoU和MI，可以看到对于mIoU改进的频率组合，它们的MI始终减少，表明特征图中通道间相关性降低。相反，对于mIoU下降的频率组合，它们的MI始终增加。

**表1：** 图1中最佳和最差情况的特征通道间互信息。我们发现当性能提升时，互信息(MI)始终减少。

| 数据集 | FSS-1000 | | | Deepglobe | | | ISIC | | | Chest X-ray | | |
|--------|----------|----------|----------|-----------|-----------|-----------|------|------|------|-------------|-------------|-------------|
| | baseline | best | worst | baseline | best | worst | baseline | best | worst | baseline | best | worst |
| 1-shot mIoU | 77.54 | 64.34↓ | 48.05↓ | 33.19 | 40.42↑ | 33.44↑ | 32.65 | 33.16↑ | 27.12↓ | 47.34 | 61.58↑ | 31.39↓ |
| support MI | 1.3736 | 1.3791↑ | 1.8767↑ | 1.3679 | 1.3502↓ | 1.3558↓ | 1.3789 | 1.3697↓ | 1.3951↑ | 1.3952 | 1.3930↓ | 1.4315↑ |
| query MI | 1.3739 | 1.3805↑ | 1.8201↑ | 1.3667 | 1.3435↓ | 1.3598↓ | 1.3792 | 1.3694↓ | 1.3890↑ | 1.3921 | 1.3877↓ | 1.4368↑ |

**图2：** 四个目标数据集上图1中最佳情况的通道平均幅度(MMC)。对于性能改进的域，掩码后它们的曲线低于基线。

互信息值越高，通道间相关性越大，而低MI表示不同通道捕获的语义信息更加独立。因此，实验结果表明，性能改进与特征图中通道间相关性的降低相关。

### 2.3 为什么更低的通道间相关性更好？

通道间相关性的降低在两个方面有利于我们的模型：

**(1) 跨域泛化。** 先前的工作[2, 51]表明，特征间较低的相关性意味着冗余性降低和泛化能力增强。直观地，较低的通道间相关性表明通道更独立地捕获模式，因此每个通道将更均匀地捕获输入图像中的模式，这意味着每个通道在所有图像中的平均幅度将更加均匀。与我们的直觉一致，[30]显示通道偏差问题影响少样本方法的泛化能力，它利用通道平均幅度(MMC)来可视化和测量特征中的通道响应，有效的少样本方法在测试集中可能有更均匀的MMC曲线。因此，这意味着相关性的降低也通过解决通道偏差问题来有利于我们的模型，如[30]中所研究的。

受此启发，我们在四个目标数据集上可视化应用掩码过滤频率分量前后的MMC。如图2所示，对于FSS-1000，掩码后性能下降，曲线比基线更陡峭。相反，对于其他三个目标数据集，掩码后性能提升，曲线比基线更均匀。这表明频率过滤也处理了通道偏差问题，有利于模型具有更独立和多样的语义模式来表示目标域。

**(2) 探索更大的分割激活区域。** 为了研究为什么通过频率过滤降低通道间相关性有利于分割任务，我们可视化了过滤特定频率分量前后特征图的热力图。如图3(a)所示，过滤某些频率分量后，热力图显示激活区域扩展，这是由于独立通道捕获的更多识别模式的结果。由于分割任务要求模型像素级地检测整个语义对象，扩展的激活区域意味着模型可以更好地检测整个对象，而不是只关注最具判别性的部分。

### 2.4 为什么在频域进行特征解耦？

在本小节中，我们说明为什么特征解耦在频域中进行。

**傅里叶变换(FT)** FT将有限信号转换为频率的复值函数。对于特征图的单个通道 $f \in \mathbb{R}^{h×w}$，傅里叶变换公式为：

$$F(u, v) = \frac{1}{wh}\sum_{x=0}^{w-1}\sum_{y=0}^{h-1}f(x, y)e^{-i2π(\frac{ux}{w} + \frac{vy}{h})}$$

其中 $i$ 是虚数单位，$h$ 和 $w$ 是 $f$ 的高度和宽度。$f(x, y)$ 是 $f$ 在空间像素 $(x, y)$ 处的元素，$F(u, v)$ 表示频率分量 $(u, v)$ 处的傅里叶系数。

空间特征 $f$ 分解为振幅 $α$ 和相位 $ρ$ 的过程称为谱分解。相应的频率特征 $F$ 可以从振幅 $α$ 和相位 $ρ$ 重新组装($|F|$ 是 $F$ 的模)：

$$F = α \cos(ρ) + iα \sin(ρ) = α · e^{iρ}$$

$$|F| = \sqrt{α^2(\cos^2(ρ) + \sin^2(ρ))} = \sqrt{α^2} = α$$

**数学推导。** 为了直观地证明相位差与特征图内通道相关性之间的关系。对于表示不同特征的特征图的不同通道，$F_1(m, n) = α_1e^{iρ_1}$ 和 $F_2(m, n) = α_2e^{iρ_2}$ 定义为不同通道中同一位置的频域表示。相关系数基于频域中的以下公式计算：

$$r = \sum_{m=0}^{h-1}\sum_{n=0}^{w-1}\frac{F_1(m, n)F_2^*(m, n)}{\sqrt{|F_1(m, n)|^2|F_2(m, n)|^2}} = \sum_{m=0}^{h-1}\sum_{n=0}^{w-1}r(m, n)$$

$F_2^*(m, n)$ 是 $F_2(m, n)$ 的复共轭，可以计算为：

$$F_2^*(m, n) = α_2 \cos(ρ_2) - iα_2 \sin(ρ_2) = α_2e^{-iρ_2}$$

将方程(2)、(3)和(5)代入方程(4)得到：

$$F_1(m, n)F_2^*(m, n) = α_1α_2e^{i(ρ_1-ρ_2)}$$

$$|F_1(m, n)|^2|F_2(m, n)|^2 = α_1^2α_2^2$$

从中我们可以进一步推导：

$$r(m, n) = \frac{α_1α_2e^{i(ρ_1-ρ_2)}}{\sqrt{α_1^2α_2^2}} = e^{i(ρ_1-ρ_2)}, ρ_1 - ρ_2 = Δρ ∈ [0, π]$$

根据欧拉公式，我们知道 $e^{πi} = -1$ 和 $e^0 = 1$。从这个推导中，我们证明了空间域中特征间的相关性可以转换为频域中的相位差和振幅。当频率分量相同时，可以推断出以下结论：1) $Δρ = 0$，$r(m, n) = 1$ 表示完全正相关；2) $Δρ = π$，$r(m, n) = -1$ 表示完全负相关。因此，当频域中不同通道的更多对应点的相位差聚集在0或π附近时，通道间存在较高的相关性。对于振幅，当相位差相同时，振幅越接近，波形越相似，从而表明通道间的相关性越高。

**推导实验。** 为了验证我们的推导，我们测量了通道间的相位差直方图，使用振幅作为权重，以观察特征图通道间相位差的关系。相位差和权重如下：

$$Δρ = |ρ_1 - ρ_2|, weight = \frac{α_1α_2}{|α_1 - α_2|}$$

图3(b)所示的结果表明，对于FSS-1000，掩码某些频率分量后，通道间相关性增加。相应地，通道间的相位差趋向于更多地聚集在0和π附近。相反，对于胸部X光，掩码某些频率分量减少了通道间相关性，导致聚集在0和π附近的相位差更少。实验结果验证了我们推导结论的准确性。

**图3：** (a) 掩码某些频率分量后，模型的注意区域扩大，包含更多模式。(b) 相位差在0和π处的更高浓度表示更高的相关性，因此在FSS-1000上性能下降，但在胸部X光上增加。

### 2.5 结论和讨论

通过数学推导和实验，我们证明了操纵频率可以降低特征图中的通道间相关性。特征图的每个通道代表一个不同的模式，较低的通道间相关性意味着更高程度的通道解耦，导致每个特征的更独立和多样的语义模式。这有利于模型：1) 缓解通道偏差，提升模型在目标域上的鲁棒性；2) 更大的分割激活区域，因此简单的频率过滤操作可以显著提升CD-FSS任务的性能。

基于上述分析，我们可以得出以下见解：1) 上述掩码在输入级别操作，但从根本上影响特征图的通道相关性。因此，我们可以直接将掩码操作应用于特征图中每个通道的频域；2) 不同域需要过滤不同的分量。上述掩码基于目标域手动过滤不同频率，但掩码可以是自适应的；3) 上述掩码在FSS-1000上表现不佳。我们认为这可能是由于过于粗糙的高低频分割。可以设计更精细的频率分割，将频率分为 $h × w$ 部分(其中 $h$ 和 $w$ 是特征图的空间维度)。

## 3. 方法

我们的方法包括两个主要步骤，即：1) 提出振幅-相位掩码器来减少特征相关性，获得更准确和泛化的特征图；2) 提出自适应通道相位注意力来选择有利于当前实例的特征并对齐支持和查询的特征空间。我们的模块不需要源域训练，可以在目标域微调期间直接集成。我们方法的总体框架如图4所示。

### 3.1 振幅-相位掩码器

振幅-相位掩码器(APM)是一个模型无关的模块，在特征图内的特征级别过滤掉负面频率分量。通过数学推导，证明APM完成了特征解耦。因此，这导致了更鲁棒、泛化性更强且提供更广泛和准确表示的特征图。

在我们的工作中，我们利用在源域上训练的固定编码器来提取特征图 $F \in \mathbb{R}^{c×h×w}$，其中 $c$、$h$ 和 $w$ 表示通道、高度和宽度。然后我们应用快速傅里叶变换(FFT)将这些特征图从空间域转换到频域，进一步将它们分解为相位谱 $P$ 和振幅谱 $A$：

$$Ae^{iP} = FFT(F)$$

然后，从FFT获得的相位和振幅分别与它们各自的sigmoid激活的相位掩码(PM) $M_p$ 和振幅掩码(AM) $M_a$ 进行Hadamard乘积。这个操作有效地从相位和振幅中过滤掉负面分量：

$$P_{enh} = Sigmoid(M_p) ⊗ P$$
$$A_{enh} = Sigmoid(M_a) ⊗ A$$

其中 $⊗$ 表示逐元素乘法，$P_{enh}$ 和 $A_{enh}$ 分别表示增强的相位和振幅。对于每个任务，APM用全1初始化，其中 $Sigmoid(M_*) ∈ [0, 1]$。这里，1允许频率分量完全通过，而0导致它们完全过滤。原始APM(APM-S)是一个轻量级模块，配置为与特征图的高度和宽度匹配的 $h × w$ 矩阵。我们还提供APM的变体(APM-M)，将维度扩展到 $c × h × w$，与特征图的维度对齐。

过滤后的相位和振幅分量被重新组合，并使用逆快速傅里叶变换(IFFT)转换回空间域以产生增强的特征图：

$$F_{enh} = IFFT(A_{enh}e^{iP_{enh}})$$

我们使用支持及其对应标签迭代优化APM。APM处理后，模型生成更准确和泛化的特征图。然后将此特征图输入后续的自适应通道相位注意力模块进行进一步优化。

**图4：** 1-shot示例中我们方法的概述。获得特征图后，引入APM根据不同域自适应过滤某些频率分量，促进特征解耦以实现更泛化的表示。此外，我们提出ACPA鼓励模型专注于更有效的特征，同时对齐支持和查询图像的特征空间。APM和ACPA的内部结构以绿色突出显示。

### 3.2 自适应通道相位注意力

自适应通道相位注意力(ACPA)可以看作是特征选择的过程。基于APM优化的特征图，ACPA鼓励模型专注于更有效的通道(特征)，同时对齐支持和查询的特征空间。其基本洞察是振幅和相位分别被视为风格和内容。因此，相位可以被视为不变表示，在支持和查询中具有一致的相位元素。

对于增强的支持特征图 $F_{enh}^{sup}$，应用支持掩码 $M^s ∈ \{0, 1\}^{H×W}$ 来丢弃不相关的激活：

$$F_{mask}^{sup} = F_{enh}^{sup} ⊗ M^s$$

输入到ACPA的后续操作与应用于查询特征图的操作一致。因此，我们统一将输入ACPA的特征图称为 $F_{enh}$。我们采用遵循SENet[19]的SE块作为我们的通道注意力模块，表示为SE：

$$W_{phase} = SE(P_{enh})$$

其中 $W_{phase} ∈ \mathbb{R}^{c×1×1}$ 是相位注意力权重，$P_{enh}$ 是 $F_{enh}$ 的相位。然后我们将相位注意力权重应用于特征图 $F_{enh}$ 以获得最终特征图 $F_{final}$：

$$F_{final} = ζ_l(W_{phase}) ⊗ F_{enh}$$

其中 $⊗$ 是Hadamard乘积，$ζ_l(*)$ 通过沿空间维度扩展来扩展权重以匹配特征图的维度，即 $ζ_l: \mathbb{R}^{c×1×1} → \mathbb{R}^{c×h×w}$。

最后，一对查询特征图 $F_{final}^{qry}$ 和支持特征图 $F_{final}^{sup}$ 被输入比较模块，使用余弦相似性形成亲和力图 $C ∈ \mathbb{R}^{h×w×h×w}$：

$$C(m, n) = ReLU(\frac{F_{final}^{qry}(m) · F_{final}^{sup}(n)}{||F_{final}^{qry}(m)|| ||F_{final}^{sup}(n)||})$$

其中 $m$、$n$ 分别表示特征图 $F_{final}^{qry}$ 和 $F_{final}^{sup}$ 的2D空间位置。然后，$C(m, n)$ 被输入解码器以获得分割结果，如图4所示。

## 4. 实验

### 4.1 数据集

我们使用PATNet[24]建立的基准，并采用相同的数据预处理方法。对于训练，我们的源域是PASCAL-5i数据集[35]，这是PASCAL VOC 2012[13]的扩展版本，增加了来自SDS数据集的额外注释。对于评估，我们的目标域包括FSS-1000[26]、Deepglobe[10]、ISIC2018[9, 38]和胸部X光数据集[6, 20]。更多数据集详情请参见附录A.1。

### 4.2 实现细节

我们采用ResNet-50[18]作为编码器，用ImageNet[34]上预训练的权重初始化。训练方式与我们的基线模型HSNet[31]一致。为了优化内存使用并加快训练速度，支持和查询图像的空间大小都设置为400×400。模型使用Adam[21]优化器训练，学习率为1e-3。

在适应阶段，模型首先预测支持掩码，然后使用相应标签通过CE损失优化APM和ACPA。APM和ACPA的适应阶段利用来自conv5_x的特征图，通道维度为2048，空间大小为13×13，使用Adam优化器进行，胸部X光的学习率设置为0.1，FSS-1000和ISIC设置为0.01，Deepglobe设置为1e-5。每个任务进行总共60次迭代。

### 4.3 与最先进工作的比较

在表2中，我们将我们的方法与PATNet[24]引入的基准上的几种最先进的少样本语义分割方法进行比较。我们的结果显示在1-shot和5-shot任务中跨域语义分割都有显著改进。具体来说，基于ResNet-50的APM-S在1-shot和5-shot设置中分别比最先进的PATNet平均性能提升2.87%和0.87%。APM-M比最先进方法分别提升3.97%和3.19%。此外，图5展示了我们方法在1-way 1-shot分割中的定性结果，突出了在大域差距中泛化的显著增强，同时在相似域偏移中保持可比的准确性。

**表2：** CD-FSS基准上1-shot和5-shot结果的平均IoU。最佳和次佳结果分别用粗体和下划线表示。*表示我们自己实现的模型。APM-S是1×h×w矩阵，而APM-M(更多参数)扩展到c×h×w。

| 方法 | FSS-1000 | | Deepglobe | | ISIC | | Chest X-ray | | Average | |
|------|----------|----------|-----------|-----------|------|------|-------------|-------------|---------|---------|
| | 1-shot | 5-shot | 1-shot | 5-shot | 1-shot | 5-shot | 1-shot | 5-shot | 1-shot | 5-shot |
| PGNet[45] | 62.42 | 62.74 | 10.73 | 12.36 | 21.86 | 21.25 | 33.95 | 27.96 | 32.24 | 31.08 |
| PANet[41] | 69.15 | 71.68 | 36.55 | 45.43 | 25.29 | 33.99 | 57.75 | 69.31 | 47.19 | 55.10 |
| CaNet[46] | 70.67 | 72.03 | 22.32 | 23.07 | 25.16 | 28.22 | 28.35 | 28.62 | 36.63 | 37.99 |
| RPMMs[43] | 65.12 | 67.06 | 12.99 | 13.47 | 18.02 | 20.04 | 30.11 | 30.82 | 31.56 | 32.85 |
| PFENet[37] | 70.87 | 70.52 | 16.88 | 18.01 | 23.50 | 23.83 | 27.22 | 27.57 | 34.62 | 34.98 |
| RePRI[5] | 70.96 | 74.23 | 25.03 | 27.41 | 23.27 | 26.23 | 65.08 | 65.48 | 46.09 | 48.34 |
| HSNet[31] | 77.53 | 80.99 | 29.65 | 35.08 | 31.20 | 35.10 | 51.88 | 54.36 | 47.57 | 51.38 |
| HSNet*[31] | 77.54 | 80.21 | 33.19 | 36.46 | 32.65 | 35.09 | 47.34 | 48.63 | 47.68 | 50.10 |
| PATNet[24] | 78.59 | 81.23 | 37.89 | 42.97 | 41.16 | 53.58 | 66.61 | 70.20 | 56.06 | 61.99 |
| Ours(APM-S) | 78.25 | 80.29 | 40.77 | 44.85 | 41.48 | 49.39 | 75.22 | 76.89 | 58.93 | 62.86 |
| **Ours(APM-M)** | **79.29** | **81.83** | **40.86** | **44.92** | **41.71** | **51.16** | **78.25** | **82.81** | **60.03** | **65.18** |

**图5：** 我们模型的定性结果。

### 4.4 消融研究

**各模块的有效性。** 我们在1-shot和5-shot设置中评估了每个提出的模块，以评估它们的有效性。如表3详述，引入APM-S使1-shot和5-shot的平均mIoU分别增加10.09%和11.29%。添加ACPA进一步增强了mIoU，分别提升1.16%和1.47%。此外，APM-M是APM的变体，具有更多参数，当与ACPA结合时，1-shot和5-shot的平均mIoU分别增加12.35%和15.08%。

**表3：** 各种设计的消融研究

| APM-S | APM-M | ACPA | 1-shot | 5-shot |
|-------|-------|------|--------|--------|
| | | | 47.68 | 50.10 |
| ✓ | | | 57.77 | 61.39 |
| ✓ | ✓ | | 58.93 | 62.86 |
| | ✓ | | 59.13 | 63.53 |
| | ✓ | ✓ | 60.03 | 65.18 |

**模型无关方法。** 我们为FPTrans[47]实现了我们的方法，该方法采用视觉Transformer(ViT)[12]作为其编码器。如表4所示，我们的方法也可以有效增强基于transformer架构的模型性能。此外，新的大规模SAM[22]模型显著推进了图像分割，展示了令人印象深刻的零样本能力。然而，SAM不适合跨域少样本分割。因此，我们评估PerSAM[48]以将我们的方法与基于SAM的方法进行比较。结果显示我们的方法在跨域少样本分割中比PerSAM表现更好。

**表4：** 在transformer架构中实现的APM-S

| | FSS | Deepglobe | ISIC | Chest | Average |
|---|-----|-----------|------|-------|---------|
| perSAM[48] | 79.65 | 33.39 | 21.27 | 31.12 | 41.35 |
| FPTrans[47] | 78.90 | 38.29 | 47.60 | 78.92 | 60.93 |
| FPTrans+ours | 79.84 | 39.78 | 50.37 | 79.29 | 62.32 |

**与其他方法的比较。** 为了证明我们方法的有效性，我们将其与全参数微调和特征解耦方法进行比较，如表5所示。与全参数微调相比，我们的方法使用更少的参数并实现更好的性能。对于空间域特征解耦，我们在训练期间向基线模型添加互信息损失，以鼓励特征图的每个通道学习独立表示。我们的方法显著优于这种方法。直观地，频域中的特征解耦提供更精细的粒度和全局表示，这比空间域中的局部表示对分割任务更有利。

**表5：** 将我们的方法与微调和空间域特征解耦方法比较

| | FSS | Deepglobe | ISIC | Chest | Average |
|---|-----|-----------|------|-------|---------|
| baseline | 77.54 | 33.19 | 32.65 | 47.34 | 47.68 |
| baseline + ft | 78.06 | 33.54 | 33.28 | 74.16 | 54.76 |
| baseline+MI Loss | 78.90 | 32.28 | 32.53 | 52.12 | 48.76 |
| ours(APM-M) | 79.29 | 40.86 | 41.71 | 78.25 | 60.03 |

### 4.5 APM：通过频率操作的特征解耦

**降低通道间相关性。** 如表6所示，我们通过计算特征图通道间的互信息验证了APM降低特征间相关性和提高泛化性能的能力。与表1相比，这个结果表明自适应特征级方法比输入级掩码更有效，进一步降低了特征间相关性。此外，我们绘制了特征图中通道间相关性的累积分布函数(CDF)，如图6所示。可以观察到，包含APM后，CDF曲线向左移动，表明通道间相关性降低。

**表6：** 通过平均互信息(MI)验证APM的有效性。(w/o ACPA)

| APM-S | FSS | Deepglobe | ISIC | Chest |
|-------|-----|-----------|------|-------|
| 1-shot mIoU | 77.98↑ | 40.74↑ | 38.79↑ | 73.55↑ |
| support MI | 1.3501↓ | 1.2761↓ | 1.3139↓ | 1.2610↓ |
| query MI | 1.3509↓ | 1.2794↓ | 1.3121↓ | 1.2620↓ |

**图6：** 通道间相关性的累积分布函数(CDF)。通过APM后，CDF曲线向左移动，表明通道间相关性降低。

**更独立的语义表示。** 如表7(左)所示，我们可视化了经APM处理和未经APM处理的特征图热力图。显然，应用APM后，模型关注更多不同的特征。例如，在第一列中，基线只突出天鹅的头部，而APM使每个特征表示更加独立，允许模型关注天鹅的各种特征。

### 4.6 ACPA：对齐任务相关特征和特征空间

ACPA可以看作特征选择，使模型能够专注于对当前任务更有效的特征，同时对齐支持和查询特征图的特征空间。如表7(左)所示，APM解耦特征并产生更广泛表示的特征图后，ACPA选择对当前任务更有效和判别性的特征。例如，在第一行中，ACPA选择天鹅的翅膀和头部。在第二列中，它选择鸟的头部、尾巴和脚。此外，我们测量了CKA(中心核对齐)来计算支持特征图和查询特征图之间的距离，验证ACPA对齐支持和查询特征空间。CKA被提出来测量域内和域间距离[52]；CKA值越小，特征空间越接近。如表7(右)所示，应用APM后，支持和查询之间的距离减少，添加ACPA后，支持和查询特征空间进一步对齐。

**表7：** (左)特征图可视化显示：1) APM实现特征解耦。2) ACPA鼓励模型专注于更有效的特征。(右)通过CKA测量验证ACPA在对齐支持和查询特征空间方面的有效性。

| APM-S | APM-M | ACPA | FSS | Deepglobe | ISIC | Chest |
|-------|-------|------|-----|-----------|------|-------|
| | | | 0.3591 | 0.2691 | 0.2494 | 0.5848 |
| ✓ | | | 0.3481 | 0.2678 | 0.2433 | 0.5025 |
| ✓ | ✓ | | 0.2907 | 0.2676 | 0.2032 | 0.3628 |
| | ✓ | | 0.3293 | 0.2675 | 0.2310 | 0.4635 |
| | ✓ | ✓ | 0.2883 | 0.2674 | 0.1811 | 0.3986 |

### 4.7 与域迁移方法的比较

我们将我们的方法与传统的基于频率和基于相关性的方法进行比较，以验证我们方法的有效性。为了公平比较，所有方法都在基线HSNet[31]上实现，然后在CD-FSS基准的1-shot设置下评估。

**基于频率的方法** DFF[27]保留有利于泛化的频率信息。GFNet[32]用全局频率过滤层替换自注意力层。ARP[7]通过振幅变换引入振幅-相位重组。DAC[23]提出了一种归一化方法，通过谱分解移除风格(振幅)同时保留内容(相位)。尽管这些方法提高了泛化性，但在解决大域差距方面仍然不足。我们的方法不需要源域训练。它在特征级别为目标域自适应掩码有害分量。通过分别处理振幅和相位，我们利用相位不变性来设计处理类内变化的通道注意力模块。如表8所示，我们的方法在CD-FSS任务上优于现有的基于频率的方法。

**表8：** 在1-shot设置下将我们的方法与先前基于频率的方法比较

| | FSS | Deepglobe | ISIC | Chest | Average |
|---|-----|-----------|------|-------|---------|
| baseline[31] | 77.54 | 33.19 | 32.65 | 47.34 | 47.68 |
| DFF[27] | 78.18 | 32.16 | 35.71 | 60.29 | 51.59 |
| GFNet[32] | 76.86 | 32.23 | 33.95 | 53.12 | 49.04 |
| ARP[7] | 78.83 | 35.06 | 35.61 | 59.83 | 52.33 |
| DAC[23] | 78.83 | 35.98 | 36.02 | 57.66 | 51.98 |
| ours(APM-M) | 79.29 | 40.86 | 41.71 | 78.25 | 60.03 |

**基于相关性的方法** 对于直接约束模型(正交性、白化)的方法：少样本设置意味着有限的样本大小，而现有模型有大量参数。使用如此小的数据集直接用约束调整模型是无效的，甚至可能导致负优化。如表9所示，正交性约束(SRIP[1])和白化的性能不令人满意。对于像MMC[30]这样的特征变换/增强方法：不能保证稳定性，因为它们使用特定的特征变换函数。由于域差距，对一个域有效的变换方法可能对其他域无效。相比之下，我们的方法具有以下优势：1) 轻量级(允许在少样本设置中快速适应)和2) 稳定和鲁棒(对不同目标域进行自适应调整)。这些优势在性能结果中得到很好的体现。

**表9：** 在1-shot设置下将我们的方法与其他降低相关性方法比较

| | FSS | Deepglobe | ISIC | Chest | Average |
|---|-----|-----------|------|-------|---------|
| baseline[31] | 77.54 | 33.19 | 32.65 | 47.34 | 47.68 |
| MMC(Simple)[30] | 77.48 | 34.70 | 34.32 | 48.74 | 48.81 |
| MMC(Oracle)[30] | 77.45 | 35.12 | 34.59 | 50.27 | 49.36 |
| SRIP[1] | 78.13 | 34.61 | 34.05 | 50.58 | 49.34 |
| baseline+whitening | 77.92 | 33.22 | 32.98 | 50.89 | 48.75 |
| ours(APM-M) | 79.29 | 40.86 | 41.71 | 78.25 | 60.03 |

## 5. 相关工作

**少样本学习** 少样本学习旨在用有限的标注样本为新概念构建鲁棒表示。现有方法通常分为三类：度量学习[36, 39]、基于优化的方法[14, 33]和基于图的方法[15, 28]。最近，由于元测试和元训练阶段在数据分布和标签空间方面的差异，跨域少样本学习获得了关注。BSCD-FSL[16]为跨域少样本学习引入了一个具有挑战性的基准，具有源域和目标域之间的显著域差距。它涵盖了与自然图像相似性不同的几个目标域。

**少样本语义分割** 少样本语义分割旨在仅用少量标注样本在查询图像中分割未见类别。OSLSM[35]是第一个双分支FSS模型。接下来，PL[11]引入了利用像素和原型之间余弦相似性的原型学习范式。SG-One[49]采用掩码平均池化(MAP)来优化支持特征的提取。最近，许多FSS方法在研究社区中出现，如RPMMs[43]、PFENet[37]、ASGNet[25]和HSNet[31]。HSNet在多级特征相关性上采用高效的4D卷积，作为我们工作的基线。然而，这些方法主要解决同一域内新类别的分割，由于显著的特征分布差异，在跨越不同域的泛化方面存在困难。弥合这种显著的域差距，特别是在有限标记数据的情况下，仍然是一个可怕的挑战。

## 6. 结论

在本文中，我们深入研究了基于不同域过滤特定频率分量显著提升性能的现象，通过实验和数学推导提供解释。基于我们的解释，我们提出了APM，一个特征级频率分量掩码，旨在增强特征图表示的泛化性。此外，我们引入了ACPA。基于APM优化的特征图，ACPA鼓励模型专注于更有效的特征，同时对齐支持和查询的特征空间。实验结果证明了该方法在减少域差距方面的有效性。

## 致谢

这项工作得到了国家自然科学基金(批准号62206102、62436003、62376103和62302184)；湖北省科技支撑计划(批准号2022BAA046)；湖北省科技人才服务项目(批准号2024DJC078)；以及蚂蚁集团通过CCF-蚂蚁研究基金的支持。

## 参考文献

[1] N Bansal, X Chen, and Z Wang. Can we gain more from orthogonality regularizations in training deep cnns? arxiv 2018. arXiv preprint arXiv:1810.09102.

[2] Adrien Bardes, Jean Ponce, and Yann LeCun. Vicreg: Variance-invariance-covariance regularization for self-supervised learning. arXiv preprint arXiv:2105.04906, 2021.

[3] David Bau, Bolei Zhou, Aditya Khosla, Aude Oliva, and Antonio Torralba. Network dissection: Quantifying interpretability of deep visual representations. In Proceedings of the IEEE conference on computer vision and pattern recognition, pages 6541–6549, 2017.

[继续列出所有参考文献...]

## 附录 / 补充材料

### A.1 更多数据集详情

**图7：** 四个目标数据集的分割示例。

我们的实验设置基于PATNet[24]建立的基准。图7展示了四个目标数据集的分割示例。进一步的详细信息如下：

**PASCAL-5i**[35] 通过整合来自SDS数据集[17]的额外注释扩展了PASCAL VOC 2012[13]。利用PASCAL-5i作为我们的训练源域，然后我们评估模型在四个目标数据集上的性能。

**FSS-1000**[26] 是一个少样本分割数据集，包含1000个自然图像类别，每个类别包含10个样本。在我们的实验中，我们遵循语义分割的官方分割，并在指定的测试集上报告结果，该测试集包含240个类别和2,400张图像。我们将FSS-1000视为我们指定的测试目标域。

**Deepglobe**[10] 由在7个类别中在像素级别密集标注的卫星图像组成：城市、农业、牧场、森林、水域、贫瘠和未知。由于地面真实标签仅在训练集中可用，我们利用包含803张图像的官方训练数据集来展示我们的结果。我们将其指定为我们的测试目标域，并遵循与PATNet相同的处理方法。

**ISIC2018**[9, 38] 专门设计用于皮肤癌筛查，包含病变图像，每个图像描绘正好一个主要病变。遵循PATNet建立的指南，我们处理和利用数据集，将ISIC2018视为我们的测试目标域。

**胸部X光**[6, 20] 专为结核病诊断而定制，包含566张分辨率为4020×4892像素的图像。这些图像描绘了58名结核病患者和80名正常状况个体的病例。处理大图像尺寸的常见方法是将它们调整为1024×1024像素。

### A.2 APM通过频域掩码降低通道间相关性

**图8：** APM前后特征图中通道间相位差的直方图(按振幅加权)。

如图8所示，我们展示了添加APM模块前后特征图中通道间相位差的直方图(按振幅加权)。应用APM后，集中在0和π附近的通道间相位差减少，这与我们在正文中的数学推导一致。APM通过改变相位和振幅来降低特征图通道间的相关性，从而增强其语义表示的独立性。此外，由于使用更精细的频域分割，与输入级别的简单高低频分割相比，APM在FSS-1000上表现良好。

### A.3 分析APM过滤的频率分量

**图9：** 掩码器过滤的频率分量的可视化。

图9中的可视化结果显示了振幅掩码器和相位掩码器在不同域中过滤的平均频率分量。中心表示低频，外围表示高频。白色表示值为1，意味着频率分量通过，黑色表示值为0，意味着频率分量被过滤掉。

对于FSS，振幅掩码器(AM)主要过滤掉中高频分量，而相位掩码器(PM)主要保留中频分量。对于DeepGlobe，AM和PM都保留更多中高频。对于ISIC，AM过滤掉更多中高频，保留低频，而PM保留相对更多的中频。对于ChestX，AM主要保留低频分量，而PM过滤掉整个频谱的频率，保留相对更多的低中频。

这些结果与我们正文图1中观察到的模式很好地一致。显然，对于不同的目标，AM和PM动态和自适应地过滤不同的频率分量，选择对当前域更有利的分量。此外，有利的振幅和相位频率分量在不同目标域中变化，强调了分别考虑振幅和相位的必要性。

### A.4 详细消融研究结果

在正文中，我们通过呈现平均mIoU来证明各种设计的有效性。在这里，如表10所示，我们提供每个目标数据集的详细结果。

**表10：** 各种设计的详细消融研究结果(骨干：ResNet-50)

| APM-S | APM-M | ACPA | FSS-1000 | | Deepglobe | | ISIC | | Chest X-ray | | Average | |
|-------|-------|------|----------|----------|-----------|-----------|------|------|-------------|-------------|---------|---------|
| | | | 1-shot | 5-shot | 1-shot | 5-shot | 1-shot | 5-shot | 1-shot | 5-shot | 1-shot | 5-shot |
| | | | 77.54 | 80.21 | 33.19 | 36.46 | 32.65 | 35.09 | 47.34 | 48.63 | 47.68 | 50.10 |
| ✓ | | | 77.98 | 79.85 | 40.74 | 44.80 | 38.79 | 44.16 | 73.55 | 76.73 | 57.77 | 61.39 |
| ✓ | ✓ | | 78.25 | 80.29 | 40.77 | 44.85 | 41.48 | 49.39 | 75.22 | 76.89 | 58.93 | 62.86 |
| | ✓ | | 78.98 | 81.21 | 40.81 | 44.82 | 38.99 | 45.49 | 77.73 | 82.60 | 59.13 | 63.53 |
| | ✓ | ✓ | 79.29 | 81.83 | 40.86 | 44.92 | 41.71 | 51.16 | 78.25 | 82.81 | 60.03 | 65.18 |

### A.5 更广泛的影响

我们的研究深入探讨了基于不同域过滤特定频率分量显著改善性能的现象，提供了解释。此外，我们通过数学推导证明了频率分量与通道间相关性之间的关系。基于我们的解释和推导，我们提出了APM，一个特征级频率分量掩码，旨在增强特征图表示的泛化性。此外，我们引入了自适应通道相位注意力(ACPA)。基于APM优化的特征图，ACPA鼓励模型专注于更有效的特征，同时对齐支持和查询的特征空间。实验结果证明了我们方法的有效性显著增强了模型的跨域转移能力。这项工作不仅适用于CDFSS，还适用于域泛化和域适应等其他领域。未来的研究将旨在扩大我们的评估以涵盖更广泛的目标域，增强我们对它们在各种现实世界场景中性能的理解。
