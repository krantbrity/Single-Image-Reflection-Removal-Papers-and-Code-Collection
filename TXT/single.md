# 用于单图像反射去除的轻量级深度排斥展开网络

**作者：** Jun-Jie Huang, Tianrui Liu, Zihan Chen, Xinwang Liu (IEEE高级会员), Meng Wang (IEEE会士), Pier Luigi Dragotti (IEEE会士)

## 摘要

单图像反射去除（SIRR）是一个典型的盲源分离问题，指的是将受反射污染的图像分离为透射图像和反射图像的问题。核心挑战在于最小化不同源之间的共性。现有的深度学习方法要么忽视了特征交互的重要性，要么依赖于启发式设计的架构。在本文中，我们提出了一种新颖的深度排斥展开网络（DExNet），这是一个轻量级、可解释且有效的SIRR网络架构。DExNet主要通过展开和参数化一个简单的迭代稀疏和辅助特征更新（i-SAFU）算法构建，该算法专门设计用于解决一个新的基于模型的SIRR优化公式，该公式融合了通用排斥先验。这种通用排斥先验使展开的SAFU模块能够内在地识别和惩罚透射和反射特征之间的共性，确保更准确的分离。DExNet的原理性设计不仅增强了其可解释性，还显著提高了其性能。在四个基准数据集上的综合实验表明，DExNet实现了最先进的视觉和定量结果，同时仅使用领先方法所需参数的约8%。

**关键词：** 单图像反射去除，深度展开，盲源分离

## I. 引言

盲源分离（BSS）[1], [2], [3], [4]代表了信号和图像处理领域的基础挑战，其目标是将混合信号分解为其组成源信号。它源于各种现实应用，包括语音增强[5]、图像增强[6]、医学数据分析[7]和遥感[8]。在现实场景中，由于对源的观察不足，从混合物中发现潜在源是高度病态的。因此，利用源信号的先验知识和交互机制对有效的源分离至关重要。

单图像反射去除（SIRR）[9], [10]是一个典型的BSS问题，旨在将通过玻璃捕获的受反射污染的图像I分解为透射图像T和反射图像R。透射图像指的是来自玻璃另一侧目标场景的图像内容，反射图像指的是来自玻璃表面镜像的不同场景的图像内容。其图像形成模型[11]由于光传输过程中涉及的多种相互作用效应（包括光吸收、选择性吸收、内部反射）而变得复杂。

SIRR的主要目标是精确地将受反射污染的图像分解为透射和反射组件。这种任务涉及识别和最小化分解图像之间的共同图像内容，已知是高度病态的[12]。必须采用"简单但不过于简单"的图像形成模型[11], [13], [14], [15], [16], [17]来精确解释非线性效应，并开发一个能够自然抑制估计的透射和反射图像中共同内容出现的机制。

在本文中，我们介绍了深度排斥展开网络（DExNet），这是一个用于单图像反射去除的轻量级、可解释且有效的深度网络架构。DExNet架构通过深度展开为新的SIRR优化问题定制的创新迭代算法设计，该优化问题融合了通用排斥先验。这种先验识别和惩罚两个图像层特征之间的共性，从而增强特征解缠。DExNet关键网络单元的工作原理与基于模型的迭代算法一致，导致增强的可解释性和可控性。

具体来说，我们首先用卷积稀疏编码（CSC）制定SIRR问题，并增强通用排斥先验。虽然额外的排斥先验在最小化透射和反射图像之间的特征共性方面有效，但它也引入了优化困难。为了解决这个问题，我们引入了一个迭代稀疏和辅助特征更新（i-SAFU）算法，通过近端梯度下降增强稀疏编码和辅助特征。随后，我们将i-SAFU扩展为多尺度DExNet，特色是关键稀疏和辅助特征更新（SAFU）模块，促进透射和反射图像之间的丰富特征交互。

通过模型驱动的深度网络结构，所提出的DExNet能够实现准确的图像形成建模、有效的特征交互和鲁棒的先验学习。因此，DExNet不仅更有效，而且具有高度的可解释性。

图1比较了在Set20[18]数据集和SIR2[9]数据集的474张图像上评估的不同SIRR方法的平均PSNR（dB）、模型复杂性和参数数量。我们可以看到，与其他最先进的单图像反射去除方法相比，所提出的DExNet在更小的模型和更低的复杂性下实现了更好的性能。

本文的贡献是三方面的：
- 本文引入了一个新的基于模型的SIRR优化公式，该公式富含通用排斥先验以促进准确的图像估计和共性减少，并提出使用新颖的迭代稀疏和辅助特征更新（i-SAFU）算法来解决它。
- 我们通过深度展开以原理性方式从i-SAFU算法推导出轻量级DExNet。关键SAFU模块中受模型启发的块以低参数足迹有效增强模型性能。
- 广泛的实验表明，所提出的轻量级DExNet使用领先方法的约8%模型参数，在平均PSNR、模型复杂性和参数效率方面实现了优于现有SOTA方法的性能。

本工作的初步版本，题为深度展开反射去除网络（DURRNet），发表在ICASSP 2024[19]。除了会议版本，我们在优化公式、深度网络设计和模型性能方面提出了显著改进。在优化公式方面，DExNet通过非线性残差图像改进了形成建模，并融合了通用排斥先验而不是基于小波的排斥先验。因此，DExNet具有更轻的特征交互网络，因为它不需要使用可逆神经网络作为可学习小波变换。结果，所提出的DExNet在PSNR上比DURRNet高约2 dB，同时相对于DURRNet仅有约80%的模型参数和50%的GFLOPs模型复杂性。

论文的其余部分组织如下：第II节讨论了单图像反射去除和深度展开的相关工作。第III节介绍了深度排斥展开网络（DExNet）的细节，包括模型公式、优化算法设计和完整的DExNet架构。第IV节介绍了实现细节并呈现了实验结果和比较。最后在第V节，我们总结了论文并讨论了未来方向。

## II. 相关工作

### A. 基于模型的SIRR方法

基于模型的SIRR方法[12], [20], [21], [22], [23], [24], [25], [26], [27], [28], [29]将单图像反射去除问题制定为可处理的优化问题，并设计高效且鲁棒的迭代算法来解决它。优化问题通常包括重建项，为了简化优化，通常采用线性图像形成模型。为了约束解，已经利用了不同的先验，例如稀疏性先验、相对平滑性先验、低秩先验和非局部图像先验。

自然图像的梯度稀疏性先验已在[12], [20]中被利用，假设边缘和角点在自然图像中是稀疏的。相对平滑性先验已在[21]中提出，因为反射图像通常比透射图像更模糊。Guo等人[22]通过利用多个图像之间的相关性以及两个图像层边缘响应的稀疏性先验和独立性先验，提出了一种从多个图像进行反射分离的鲁棒方法。

Li和Brown[25]提出了一个凸模型，它意味着具有梯度阈值的偏微分方程，以从单个输入图像中抑制反射。在[24]中使用了拉普拉斯保真度先验和l₀梯度稀疏性先验来制定反射抑制的优化问题。在[23]中，高斯混合模型（GMM）已被应用于建模补丁先验以利用反射的重影效应。

Wan等人[26]基于具有非局部图像先验的稀疏表示框架提出了反射去除方法。Wan等人[27]提出了一种具有统一内容和梯度先验的区域感知单图像反射去除方法。Han等人[28]提出了一种基于低秩矩阵完成的反射去除算法，用于分离在近摄像机位置拍摄的多个图像中的反射。Heydecker等人[29]提出了一种基于优化的单图像反射去除算法，具有简单的用户交互方案和H₂保真度项以鼓励恢复细节并强制全局颜色相似性。

总的来说，基于模型的图像反射去除方法导致可解释的数学公式，但当存在强烈和复杂的反射时，特别是与基于深度学习的最新方法相比，最终结果可能不令人满意。

### B. 基于学习的SIRR方法

最近，基于学习的方法[15], [18], [19], [30], [31], [32], [33], [34], [35], [36], [37], [38], [39], [40], [41], [42], [43], [44], [45], [46], [47], [48]，特别是那些采用深度神经网络（DNN）的方法，已经出现来补充传统的基于模型的单图像反射去除方法并实现更好的性能。通过采用不同的估计策略，已经提出了新颖的深度网络架构，包括i）直接估计透射和反射图像，ii）交替估计两个图像，和iii）协作估计两个图像。

Wan等人[36]提出了具有两个协作梯度推理网络和图像推理网络的并发反射去除网络（CRRN）。增强反射去除网络（ERRNet）[37]提出学习具有通道注意力的图像反射去除网络以直接估计透射图像。此外，ERRNet利用对齐不变损失从未对齐的训练数据中学习。

Prasad等人[38]提出了一个轻量级VDESIRR模型，具有尺度子网络和渐进推理阶段来处理更高分辨率尺度。Song等人[39]研究了针对对抗攻击的鲁棒深度学习基于单图像反射去除方法。Wen等人[15]提出通过使用合成网络将非线性注入图像形成模型，使用α混合掩码合成受反射污染的图像，并使用反射去除网络联合估计透射和反射图像。

Zhang等人[18]提出了一个具有感知损失和排斥损失的卷积网络用于单图像反射去除。双向网络（BDN）[40]由级联深度网络组成，已被提出交替估计反射图像然后是透射图像。迭代增强卷积LSTM网络（IBCLN）[44]已被提出逐步将受反射污染的图像分离为两个图像层。

Dong等人[41]通过利用学习的拉普拉斯特征来定位和去除反射，提出了位置感知单图像反射去除（LASIRR）方法。Feng等人[42]使用新颖的残差深度掩蔽单元来控制信息传播，提出了用于单图像反射去除的深度掩蔽生成网络（DMGN），采用粗到细的方法。

Li等人[43]通过首先估计反射层然后估计透射层，提出了两阶段反射感知指导网络（RAGNet）。Hu等人[45]提出了两阶段"你的垃圾是我的宝藏"（YTMT）方法，具有双流分解网络以在不同分支启用信息交换。

最近，He等人[48]提出了具有残差校正的双流语义感知网络（DSRNet），具有新颖的可学习残差模块来补偿前向模型的非线性性质和互门交互（MuGI）块以启用两个图像层的特征交互。还有用于单图像反射去除的深度展开方法[19], [46], [47]。

### C. 深度展开方法

深度展开（或深度展开）方法[49], [50]旨在通过将特定任务的物理先验嵌入深度神经架构来结合基于模型和深度学习方法的优点，从而导致有效且更可解释的模型。在现有的深度展开方法中，每个单独变量的先验项的近端算子通常参数化为深度神经网络以启用从训练数据中学习。

在开创性工作[49]中，Gregor和LeCun提出将迭代收缩阈值算法（ISTA）转换为深度网络，通过将ISTA中的字典设置为稀疏编码的可学习参数。此后，出现了许多使用深度展开来解决图像/信号处理任务中逆问题的方法。

ADMM-Net[51]已被提出展开交替方向乘数法（ADMM）算法用于压缩感知磁共振成像（MRI）重建。深度展开单图像超分辨率网络（USRNet）[52]已被提出通过半二次分裂（HQS）算法展开最大后验（MAP）公式用于单图像超分辨率任务。

深度展开盲去模糊方法（DUBLID）网络[53]已被提出，它展开了仅具有少量可学习滤波器的基于全变差（TV）的盲反卷积算法。对于去雨任务，Wang等人[54]基于近端梯度下降提出了模型启发的雨卷积字典网络（RCDNet）以简化卷积算子的计算。

Zhang等人[55]通过展开近似消息传递（AMP）算法的迭代去噪过程提出AMP-Net用于视觉图像压缩感知（CS）问题。Pu等人[56]提出了一个自监督深度展开网络，用于将艺术品的X射线图像分离为表面X射线图像和隐藏X射线图像。

Aberdam等人[57]提出了具有未固定字典的稀疏编码自适应深度展开学习求解器Ada-LISTA。Huang等人[58]提出展开具有学习高斯尺度混合先验的最大后验（MAP）估计算法用于图像恢复。

Deng等人[59]通过展开多尺度多模态卷积字典学习模型提出新颖的DeepM²CDL网络用于多模态图像恢复和融合。Liu和Dragotti[60]提出了具有长短期时间一致性（LSTC）约束的深度展开卷积ISTA网络用于事件到视频重建。

也有用于反射去除的深度展开方法，然而，这些方法通过为每个图像层建模独立先验的传统深度展开方法来处理反射去除任务，并在某种程度上忽视了两个图像层中共同图像内容相互作用的重要性。

Shao等人[46]通过展开具有非局部自回归先验和去反射先验的反射去除公式提出模型指导SIRR网络（MoG-SIRR）。Zhang等人[47]通过交替更新透射和反射图像的内容和梯度，提出内容和梯度指导深度网络（CGDNet）用于SIRR。

Huang等人[19]提出深度展开反射去除网络（DURRNet），它利用可逆神经网络[61], [62]来评估排斥条件。

## III. 提出的方法

这项工作的目标是为典型的盲源分离问题（即单图像反射去除（SIRR））设计有效的深度架构。盲源分离的本质在于最小化估计源之间的共性。因此，启用交互以减少图像层之间的共同内容对于有效的反射分离至关重要。这是现有深度展开方法[46], [47]经常忽视的东西。

为了弥补这一差距，我们提出了一个高效且参数高效的深度排斥展开网络（DExNet）。DexNet根植于专门为具有通用排斥先验的卷积稀疏编码问题设计的迭代算法，该先验促进共同特征的最小化。通过展开，DExNet中的关键网络模块启用图像层之间共同内容的频繁和动态相互作用，这对于实现更精确和可靠的反射分离至关重要。

接下来，我们首先介绍所提出的基于模型的单图像反射分离优化公式，然后基于近端梯度下降为优化问题设计迭代算法，最后我们提出所提出的DExNet和训练策略。为了清晰，我们在表I中突出了一些常用的符号。

### A. 模型公式和优化问题

#### 1) 具有残差图像的模型公式

SIRR的常见和简化形成模型假设受反射污染的图像是透射图像和反射图像的线性组合[19], [34], [45], [46]。然而，这种公式并没有完全捕获由于玻璃反射导致的非线性光学相互作用。受Hu等人[48]启发，在这项工作中，我们使用"简单但不过于简单"的图像形成模型，附加非线性残差图像N项来补偿现实场景中的非线性效应。因此，图像形成模型可以表示为：

$$I = T + R + N, \quad (1)$$

其中 $I \in \mathbb{R}^{W×H×3}$ 是受反射污染的图像，$T \in \mathbb{R}^{W×H×3}$ 是透射图像，$R \in \mathbb{R}^{W×H×3}$ 是反射图像，$N \in \mathbb{R}^{W×H×3}$ 是残差图像，W和H表示图像的宽度和高度。

稀疏表示为逆问题提供了有效的先验。通过对表示施加稀疏性先验，我们可以将图像估计问题重新表述为在卷积字典上更易处理的稀疏编码问题。通常，透射图像和反射图像表现出不同的图像特征。相机主要以更大的清晰度捕获透射图像，表现为更锐利的边缘和更多细节，而相反，反射图像经常被玻璃表面遮挡，趋向于具有更模糊的外观。

考虑到这一点，我们将T、R、N建模为每个在相应卷积字典上具有稀疏表示。因此，(1)可以表示为：

$$I = \sum_{i∈\{T,R,N\}} D_i ⊗ z_i, \quad (2)$$

其中 $D_i \in \mathbb{R}^{w×w×3×n}$ 是具有空间核大小 $w × w$ 的卷积字典，$z_i \in \mathbb{R}^{W×H×n}$ 是对于 $i ∈ \{T, R, N\}$ 的稀疏特征。$z_i$ 的宽度、高度和通道数分别表示为W、H和n。这里，⊗表示卷积算子。

透射、反射和残差图像的稀疏表示，即 $z_T$、$z_R$、$z_N$，可以通过卷积稀疏编码（CSC）[63], [64]优化估计如下：

$$\arg \min_{\{z_T,z_R,z_N\}} \frac{1}{2}\left\|I - \sum_{i∈\{T,R,N\}} D_i ⊗ z_i\right\|_F^2 + \sum_{i∈\{T,R,N\}} λ_i p_i(z_i), \quad (3)$$

其中 $λ_i$ 是正则化参数，$p_i(·)$ 是稀疏先验项，例如L₁范数，用于建模特征 $z_i$ 的稀疏性。

#### 2) 具有排斥先验的优化

(3)中的优化问题只考虑每个单独图像的稀疏先验。对于盲源分离问题，惩罚估计源之间的共性至关重要。排斥损失[18]已被证明是促进共性减少的有效无监督训练损失项。然而，由于非线性tanh(·)函数，在(3)的优化问题中融合排斥损失是非平凡的。

这里，我们提出在优化问题中融合通用排斥先验[56]（其形式类似于[22]中的独立性先验）$p_E((W ⊗ T) ⊙ (W ⊗ R))$，其中 $W \in \mathbb{R}^{w×w×m×3}$ 表示泛化梯度算子的可学习卷积滤波器，$p_E(·)$ 是惩罚共同特征的惩罚函数。排斥先验通过卷积和逐元素乘法从两个图像中提取和识别共同特征。最小化排斥先验鼓励最小化共同图像内容，这是SIRR的本质。

利用这种通用排斥先验，优化问题可以重新表述为：

$$\arg \min_{\{z_T,z_R,z_N\}} \frac{1}{2}\left\|I - \sum_{i∈\{T,R,N\}} D_i ⊗ z_i\right\|_F^2 + \sum_{i∈\{T,R,N\}} λ_i p_i(z_i) + κp_E ((M_T ⊗ z_T) ⊙ (M_R ⊗ z_R)), \quad (4)$$

其中 $κ$ 是正则化参数，$M_i = W ⊗ D_i$ $(i ∈ \{T, R\})$。

与融合仅关注单个变量的先验项的传统深度展开方法相比，排斥先验涉及 $z_T$ 和 $z_R$ 并考虑两个变量之间的交互。这一事实使得优化问题更具挑战性，需要精心设计的策略来有效解决。

为了解决这个问题，我们引入辅助变量 $z_A = (M_T ⊗ z_T) ⊙ (M_R ⊗ z_R)$，它将 $z_T$ 和 $z_R$ 从排斥先验中解耦。这使我们能够设计一个有效的迭代算法，该算法解决具有闭式解的更简单子问题，同时保持丰富的特征交互。基于半二次分裂（HQS）算法，我们将(4)中的问题重新表述为涉及 $z_T$、$z_R$、$z_N$ 和 $z_A$ 的最小化问题，伴随着额外的辅助等式项：

$$\arg \min_{\{z_T,z_R,z_N,z_A\}} \frac{1}{2}\left\|I - \sum_{i∈\{T,R,N\}} D_i ⊗ z_i\right\|_F^2 + \frac{τ}{2}\left\|z_A - (M_T ⊗ z_T) ⊙ (M_R ⊗ z_R)\right\|_F^2 + \sum_{i∈\{T,R,N\}} λ_i p_i(z_i) + κp_E(z_A), \quad (5)$$

其中 $τ$ 是正则化参数。

#### 3) 迭代稀疏和辅助特征更新（I-SAFU）算法

我们提出迭代稀疏和辅助特征更新（i-SAFU）算法，基于近端梯度下降（PGD）方法[54], [65]依次更新稀疏特征 $z_T$、$z_R$、$z_N$ 和辅助变量 $z_A$。所提出的i-SAFU算法用于单图像反射去除的伪代码在算法1中给出。

我们将在下一节中看到，通用排斥先验和辅助变量的引入将通过深度展开内在地诱导具有透射和反射特征之间丰富交互的深度网络架构。

### B. 深度排斥展开SIRR网络

在本节中，我们提出DExNet，这是一个从展开i-SAFU算法导出的深度网络架构。接下来，第III-B1节提供DExNet框架概述。第III-B2节详细描述稀疏和辅助特征更新（SAFU）模块，该模块将i-SAFU算法展开为具有四个更新单元的网络模块，用于透射、反射、非线性残差和辅助特征。最后，第III-B3和III-B4节分别描述特征融合模块（FFM）和图像重建模块（IRM）。

#### 1) 框架概述

图2说明了DExNet的概述，它采用S个渐进细化尺度。在每个尺度上，框架利用K个级联SAFU模块。每个尺度s > 1还融合一个FFM来自适应地整合低尺度特征与高尺度对应物。

SAFU模块作为核心模块，促进准确的图像形成建模、有效的特征交互和鲁棒的先验学习。每个SAFU模块数学上展开i-SAFU算法的一次迭代，以对稀疏特征（即 $z_{s,k}^T$、$z_{s,k}^R$、$z_{s,k}^N$）和辅助变量 $z_{s,k}^A$ 执行交替更新。上标s、k表示尺度s ∈ [1, S]的第k次迭代，$z_{s,0}$ 表示初始输入特征。最终重建阶段利用IRM将更新的特征转换为估计的透射图像 $\hat{T}$、反射图像 $\hat{R}$ 和非线性残差图像 $\hat{N}$。

#### 2) 稀疏和辅助特征更新（SAFU）模块

SAFU模块通过展开i-SAFU算法的一次迭代设计。K个SAFU模块的概述在图3中描述。有四个基本单元，即透射特征更新（TFU）单元、反射特征更新（RFU）单元、非线性特征更新（NFU）单元和辅助特征更新（AFU）单元，分别交替更新透射特征 $z_T$、反射特征 $z_R$、非线性残差特征 $z_N$ 和辅助特征 $z_A$。

接下来，我们深入探讨SAFU模块每个基本单元的设计原理和功能。注意这里我们介绍特定尺度的SAFU模块，因此我们在本节中省略尺度符号s，因为其他尺度的方法类似。

**透射特征更新（TFU）单元：** TFU单元设计用于通过固定其他三个变量（即 $z_R$、$z_N$ 和 $z_A$）来更新透射图像 $z_T$ 的特征。通过保持(5)中与 $z_T$ 相关的项，我们建立优化 $z_T$ 的子问题如下：

$$\min_{z_T} \frac{1}{2}\left\|I - \sum_{i∈\{T,R,N\}} D_i ⊗ z_i\right\|_F^2 + λ_T p_T(z_T) + \frac{τ}{2}\left\|z_A - (M_T ⊗ z_T) ⊙ (M_R ⊗ z_R)\right\|_F^2. \quad (6)$$

透射特征 $z_T$ 可以通过解决(6)中问题的二次近似[65]来更新：

$$\min_{z_T} \frac{1}{2}\left\|z_T - \left(z_T^k - η_T∇f(z_T^k)\right)\right\|_F^2 + η_T λ_T/τ \cdot p_T(z_T), \quad (7)$$

其中解用于构造透射特征更新单元，可以表示为：

$$z_T^{k+1} = \text{prox}_{η_T λ_T/τ}\left(z_T^k - η_T∇f(z_T^k)\right), \quad (8)$$

其中 $\text{prox}_{η_T λ_T/τ}(·)$ 是对应于先验项 $p_T(·)$ 的近端算子，梯度项包括重建项和辅助等式项的梯度。

**反射特征更新（RFU）单元：** RFU单元用于更新反射图像的稀疏特征 $z_R$。RFU单元对稀疏特征 $z_R$ 的原理和更新规则类似于(8)中的 $z_T$，可以表示为：

$$z_R^{k+1} = \text{prox}_{η_R λ_R/τ}\left(z_R^k - η_R∇f(z_R^k)\right), \quad (9)$$

**非线性特征更新（NFU）单元：** NFU单元用于优化非线性残差图像N的稀疏特征 $z_N$，在固定 $z_T$ 和 $z_R$ 的情况下自适应建模无法被 $z_T$ 和 $z_R$ 很好捕获的非线性效应。$z_N$ 的子问题只涉及重建项和其先验项：

$$\min_{z_N} \frac{1}{2}\left\|I - \sum_{i∈\{T,R,N\}} D_i ⊗ z_i\right\|_F^2 + λ_N p_E(z_N). \quad (10)$$

结果，NFU单元相对于重建项执行梯度下降步骤并应用可学习近端算子来更新特征为：

$$z_N^{k+1} = \text{prox}_{η_N λ_N}\left(z_N^k - η_N∇g(z_N^k)\right), \quad (11)$$

**辅助特征更新（AFU）单元：** AFU单元用于在给定 $z_T$ 和 $z_R$ 的情况下对辅助变量 $z_A$ 施加排斥条件。其子问题如下：

$$\min_{z_A} \frac{τ}{2}\left\|z_A - (M_T ⊗ z_T) ⊙ (M_R ⊗ z_R)\right\|_F^2 + κp_E(z_A). \quad (12)$$

(12)的解用于构造AFU单元，可以表示为：

$$z_A^{k+1} = \text{prox}_{η_A κ/τ}\left(z_A^k - η_A∇h(z_A^k)\right), \quad (13)$$

**展开SAFU架构：** SAFU模块网络拓扑的设计牢固地基于从(8)、(9)、(11)和(13)中基于模型的公式导出的原理，确保网络结构的系统性和模型驱动方法。对于 $z_T$、$z_R$、$z_N$ 和 $z_A$ 中的每个特征，我们设计了相应的特征更新单元，具有可学习近端网络（LPN）以从训练数据集学习并捕获先验信息。卷积核 $\{D_i^k\}_{i=\{T,R,N,A\}}$ 和 $\{M_i^k\}_{i=\{T,R\}}$ 设置为可学习的。

因此，DExNet的第k个SAFU模块可以表示如下：

$$\begin{cases}
z_T^{k+1} = \text{LPN}_{θ_T^k}\left(z_T^k - η_T∇f(z_T^k)\right), \\
z_R^{k+1} = \text{LPN}_{θ_R^k}\left(z_R^k - η_R∇f(z_R^k)\right), \\
z_N^{k+1} = \text{LPN}_{θ_N^k}\left(z_N^k - η_N∇g(z_N^k)\right), \\
z_A^{k+1} = \text{LPN}_{θ_A^k}\left(z_A^k - η_A∇h(z_A^k)\right),
\end{cases} \quad (14)$$

其中 $\{θ_i^k\}_{i=\{T,R,N,A\}}$ 表示LPN的可学习参数，$\{η_i^k\}_{i=\{T,R,N,A\}}$ 表示可学习步长。

图4说明了TFU、RFU、NFU和AFU的网络架构。这些单元共享一组基本网络组件，包括稀疏特征辅助等式（AES）块、辅助特征辅助等式（AEA）块、投影重建误差（PRE）块和LPN块。值得注意的是，TFU和RFU具有相同的网络结构，包括AES、PRE和LPN。

然而，重要的是要注意，尽管具有相同的网络块集合，不同的特征更新单元不共享模型参数。这些基本网络块的数学解释如下：

- **AES块** 构造关于∇q(·)，如(8)和(9)中，用于评估 $z_T$、$z_R$ 相对于辅助等式项的梯度。它包括特征之间的两个逐元素乘法操作，促进共同图像内容之间的交互。
- **AEA块** 构造关于∇h(·)，如(13)中，相对于两个图像层之间的共同特征更新辅助变量。它包括特征之间的一个逐元素乘法操作，然后测量与输入辅助变量的差异。
- **PRE块** 构造关于∇g(·)，如(8)、(9)和(11)中，施加重建条件。它测量输入受反射污染图像和估计重建图像之间的重建残差，然后将残差投影到特征域。
- **LPN块** 用于从数据学习先验，可以是任意网络，这里我们采用非线性激活自由（NAF）块[66]来学习近端算子 $\text{prox}_{λ}(·)$，因为它已被证明在图像恢复任务上高度有效。

在第IV-D节中，我们通过消融研究证明AES、AEA和PRE块能够以边际参数足迹显著增强分离性能，LNP块启用有效的先验学习。

#### 3) 特征融合模块（FFM）

FFM用于融合来自低尺度的上采样特征 $\{z_T, z_R, z_N, z_A\}$ 与超列特征[67]。让我们以第s尺度（s > 1）的特征融合模块为例进行说明。如图5所示，输入特征 $z_{i}^{s,0}$（$i ∈ \{T, R, N, A\}$）通过以下方式获得：

$$z_i^{s,0} = C_{1×1,i}^s ⊗ \left[U\left(z_i^{s-1,K}\right) \bigoplus R_i^s(h^s)\right], \quad (15)$$

其中 $C_{1×1,i}^s$ 表示1×1卷积算子，⊕表示通道级联算子，U(·)表示双线性上采样算子，$R_i^s(·)$ 是将下采样超列特征 $h^s$ 映射到n个通道的残差块。

#### 4) 图像重建模块（IRM）

基于卷积稀疏编码（CSC）模型，每个图像参数化为字典上的稀疏表示。因此，如图5所示，重建的透射图像 $\hat{T}$、反射图像 $\hat{R}$ 和非线性残差图像 $\hat{N}$ 通过与相应卷积字典的卷积从最终更新特征 $z_i^{S,K}$（$i ∈ \{T, R, N\}$）映射到图像域：

$$\begin{cases}
\hat{T} = D_T ⊗ z_T^{S,K}, \\
\hat{R} = D_R ⊗ z_R^{S,K}, \\
\hat{N} = D_N ⊗ z_N^{S,K},
\end{cases} \quad (16)$$

其中 $D_i ∈ \mathbb{R}^{w×w×3×n}$（$i ∈ \{T, R, N\}$）表示卷积字典。

### C. 训练损失

总体训练损失包含重建损失 $L_r$、在辅助变量 $z_A$ 上评估的辅助损失 $L_a$ 和感知损失 $L_p$：

$$L = L_r + λ_a L_a + λ_p L_p, \quad (17)$$

其中 $λ_e = 0.01$，$λ_p = 0.1$ 是正则化参数。

重建损失 $L_r$ 应用于估计的透射图像T、估计的反射图像R和基于最终特征重建的图像：

$$L_r = \|T - \hat{T}\|_2^2 + \|R - \hat{R}\|_2^2 + \|I - \hat{T} - \hat{R} - \hat{N}\|_1 \quad (18)$$

辅助损失应用于最小化辅助变量 $z_A$ 以最小化两个图像层之间的逐元素特征乘积 $(M_T ⊗ z_T) ⊙ (M_R ⊗ z_R)$：

$$L_a = \|z_A\|_1. \quad (19)$$

感知损失[18]用于以高感知质量正则化估计图像：

$$L_p = \sum_j ω_j \|\tau_j(\hat{T}) - \tau_j(T)\|_1, \quad (20)$$

其中 $τ_j(·)$ 表示在ImageNet数据集上预训练的VGG-19模型层j的特征，$ω_j$ 是不同层的权重，$ω = [0.38; 0.21; 0.27; 0.18; 6.67]$。

## IV. 实验结果

在本节中，我们展示实现细节，然后进行实验将所提出的DExNet与最先进的单图像反射去除方法进行比较，最后进行消融研究以调查DExNet的特性。

### A. 实现细节

所提出的方法使用PyTorch框架开发，模型使用Adam优化器优化。总训练轮数为50，采用早停策略。初始学习率设置为10⁻⁴，在第25轮以0.5的因子衰减。实验在配备NVIDIA GeForce RTX 4090 GPU的计算机上进行。

默认情况下，DExNet中的尺度数S设置为4，$\{D_i\}$ 中的特征通道数n设置为64，$\{M_i\}$ 中的特征通道数m设置为128。通过改变DExNet中的尺度数S和所提出的i-SAFU算法内的阶段数K来展开DExNet，我们可以在性能和模型大小之间实现不同的权衡。

我们将具有S = 2尺度和每个尺度K = 5个SAFU模块的DExNet称为DExNetS，具有4.52M参数，将具有S = 4尺度和每个尺度K = 5个SAFU模块的DExNet称为DExNetL，具有9.66M参数。

图像反射去除的质量基于两个指标评估：峰值信噪比（PSNR）和结构相似性指数（SSIM）[69]。

### B. 数据集

**训练数据。** 训练数据包括合成数据集和真实数据集。合成数据集包括来自PASCAL VOC数据集[70]的7,643个合成图像对。在每个轮次中，从合成数据集、Real89训练数据集[18]和Nature200[44]训练数据集以0.6:0.2:0.2的比例采样图像对进行训练。未采用额外的数据增强。

我们遵循DSRNet[48]的合成数据生成模型，合成叠加图像 $I_{syn}$ 可以表示为透射图像 $γ_1 T_{syn}$ 和反射图像 $γ_2 R_{syn}$ 的函数：

$$I_{syn} = γ_1 T_{syn} + γ_2 R_{syn} - γ_1 γ_2 T_{syn} ⊙ R_{syn}, \quad (21)$$

其中 $γ_1 ∈ [0.8, 1.0]$ 和 $γ_2 ∈ [0.4, 1.0]$ 是混合参数。

**测试数据。** Real20[18]和SIR2数据集[30]都用于定量和视觉比较不同的单图像反射方法。Real20[18]有20对配对的透射和混合图像。SIR2数据集[30]具有配对的透射、反射和混合图像。它有3个子集，包括具有199个测试图像的明信片数据集、具有200个测试图像的对象数据集和具有55个测试图像的野生数据集。

还有Real45数据集[35]，它从互联网收集，没有真实透射图像。它用于评估视觉质量并验证不同方法的泛化能力。

### C. 与最先进方法的比较

在本节中，我们在透射和反射图像估计上定量和视觉地比较所提出的DExNet与其他单图像反射去除方法。比较方法包括Zhang等人的方法[18]、BDN[40]、Zheng等人的方法[68]、CoRRN[34]、ERRNet[37]、IBCLN[44]、YTMT[45]、LASIRR[41]、DMCN[42]、RAGNet[43]和DSRNet[48]。

我们还考虑三种最近的基于深度展开的反射去除方法：MoG-SIRR[46]、CGDNet[47]和DURRNet[19]。然而，由于MoG-SIRR[46]和CGDNet[47]不是开源的，我们参考论文中的透射图像估计结果，并没有评估它们在反射图像估计上的性能。

#### 1) 定量比较

本节基于两个常用数据集（即Real20数据集[18]和SIR2数据集[30]）在模型有效性、模型大小和模型复杂性方面呈现定量比较。

表II显示了在Real20数据集[18]和SIR2数据集[30]的三个子集上评估的不同方法估计透射图像的定量结果。我们可以看到，总体而言，所提出的DExNet在所有比较方法中以相当小的可学习参数数量实现了优越的PSNR和SSIM结果。

具体来说，具有9.66M参数的DExNetL实现了平均25.96dB的PSNR，比具有124.60M参数的SOTA方法DSRNet高0.21dB。此外，具有4.52M参数的DExNetS具有S = 2尺度的SAFU模块，实现了与DSRNet类似的性能。

与深度展开方法MoG-SIRR[46]和CGDNet[47]相比，DExNet的结果显著更好。这可能是由于DExNet中使用的通用排斥先验和新颖的辅助展开方法。考虑到SIR2数据集中的测试图像超出了训练数据的域，具有多样的场景、照明条件和玻璃条件，DExNetL在所有指标上实现最佳平均性能是高度具有挑战性和显著的。

表III显示了在Real20数据集[18]和SIR2数据集[30]的三个子集上评估的不同方法估计反射图像的定量结果。我们使用SIR2数据集[30]的真实反射图像作为参考图像。由于Real20数据集[18]中没有真实反射图像，我们使用 $\tilde{R} = I - T$ 作为参考图像。

从表中我们可以看到，所提出的DExNetL和DExNetS分别在估计反射图像的任务中实现了最佳性能（25.70dB/0.574）和第二最佳性能（25.61dB/0.551）。相比之下，在恢复透射图像上实现第二最佳总体结果的DSRNet[48]，在恢复反射图像上获得平均25.00dB/0.507的PSNR/SSIM，比DExNetL差0.70dB/0.078。

我们还可以观察到，所提出的DExNet在恢复透射和反射图像上实现了更平衡的性能（例如25.96dB对25.70dB），而其他方法倾向于很好地恢复透射图像，但在恢复反射图像方面效果较差。

图1比较了不同方法在估计透射图像任务上的有效性、大小和复杂性。计算复杂性在224×224大小的测试图像上测量。我们可以清楚地看到，所提出的DExNet高度有效且轻量级。

在模型有效性方面，DExNet和DSRNet实现了超过25 dB的平均PSNR，而其他方法分散在[23, 24]dB范围内。在模型大小方面，两个DExNet架构都是可学习参数数量最少的方法之一。具体来说，DExNetL、DURRNet和LASIRR具有相似的参数数量（约10M参数），而DExNetL比DURRNet和LASIRR分别实现了约1.9dB和1.7dB更高的PSNR。

在模型复杂性方面，DExNetS和DExNetL具有相对较低的计算复杂性（约110 GFLOPs和170 GFLOPs），相比之下其他方法大多在[400, 1000] GFLOPs范围内。与SOTA方法DSRNet相比，DExNetL仅需要DSRNet约30%的复杂性。DExNetS和CoRRN具有最低的复杂性（约110 GFLOPs），而DExNetS比CoRRN实现了2.2dB更高的PSNR。

这个结果表明，所提出的模型启发的DExNet以显著更小的模型大小和更低的计算成本实现了优于SOTA方法的性能。

表IV进一步演示了不同方法的计算复杂性和平均运行时间。我们可以看到DExNetL的平均运行时间约为0.15s，与SOTA方法相似。我们还注意到计算复杂性结果和运行时间结果并不完全一致。这可能是由于模型对硬件的不同兼容性。

#### 2) 视觉比较

本节呈现Real20数据集[18]、SIR2数据集[30]和Real45数据集[35]上的视觉比较。

**Real20数据集：** 图6显示了来自Real20数据集[18]的三个示例图像上不同方法估计的透射和反射图像。最后一列显示了真实透射图像和反射图像供参考。我们可以看到，所提出的DExNet可以同时恢复自然外观的透射和反射图像。这可能是由于图像形成模型和先验的信息已被适当地嵌入到网络架构中。

对于比较方法，Zhang等人的方法[18]可以很好地分离输入中的大多数反射，但有时会产生具有可见伪影的图像。IBCLN[44]难以很好地分离大的重叠反射，强透射图像内容仍然存在于估计的反射图像中。ERRNet[37]在前两个图像上实现了良好的分离结果，但没有很好地恢复强烈的明亮反射。

YTMT[45]和DSRNet[48]没有准确处理复杂反射和图像内容细节，有时在估计反射图像方面可能效果较差。DURRNet[19]在分离详细结构方面效果较差。

**SIR2数据集：** 图7显示了来自SIR2数据集[30]的三个示例反射分离结果。第一列和最后一列分别显示输入混合图像和真实透射图像。

在Zhang等人[18]、IBCLN[44]、ERRNet[37]、YTMT[45]和DURRNet[19]的估计透射结果中，反射元素清晰可见。我们还注意到DSRNet[48]展示了更好的分离结果，但仍然在估计的透射和反射图像中留下了明显的共享内容。与其他方法相比，我们提出的方法实现了更准确的反射内容和透射图像分离，没有明显的共享内容。

**Real45数据集：** 图8进一步显示了来自Real45数据集[35]的三个示例图像的可视化结果，其中真实图像不可用。因此，这是模型泛化能力的良好测试场所。第一列显示输入图像，从第2列到第6列，奇数行和偶数行分别显示估计的透射和反射图像。

我们可以看到Zhang等人的方法[18]总体上可以分离透射和反射图像，但分离的反射图像通常仍包含来自透射层的信息。IBCLN[44]在Real45数据集上泛化效果不好，无法很好地分离两个图像层。ERRNet[37]也没有有效恢复反射层。YTMT[45]没有产生具有完整内容的反射图像。

DURRNet[19]可以很好地处理强反射，但在更精细的细节上效果较差。DSRNet[48]显示了更好的分离能力，但估计的反射图像具有大的模糊区域。在最后一列中，我们可以看到所提出的DExNet可以适当地从输入受反射污染图像中分离反射图像内容。反射图像包含更完整的反射内容，几乎没有来自透射图像的信息。

### D. 消融研究

在本节中，我们进行消融研究以调查网络架构和损失函数方面的性能改进。

#### 1) SAFU模块的有效性

表V显示了在来自Real20数据集[18]和SIR2数据集[30]的474张图像上评估的SAFU模块关键网络组件（包括AES、AEA、PRE和LPN块）的消融研究。从表中我们可以看到，模型启发的AES、AEA和PRE块仅需要总参数的不到4%，但可以显著改善模型性能。

其中，AES块和AEA块通过在透射和反射图像特征之间执行逐元素乘法来施加排斥条件，并启用共享特征内容的识别。AEA块使用与AES块相同的参数。我们可以看到AES块和AEA块对所提出的SAFU模块都至关重要。

移除任一块只会节省边际数量的参数，但导致PSNR性能下降约0.7 dB。当同时移除AES块和AEA块时，这等同于没有排斥先验的模型，PSNR下降约0.9 dB。这证实了引入处理T和R之间共同特征相互作用的模块对DExNet的性能至关重要。

PRE块仅需要约2%的参数，对估计的透射、反射和非线性残差图像施加重建条件。它有助于稳定训练过程并将平均PSNR提高约0.4 dB。LPN块用于学习和施加稀疏先验和通用排斥先验。我们可以看到应用LPN块进行先验学习可以将模型性能提高约1.5 dB。

为了进一步可视化AES块、ACN块、PRE块和LPN块的功能，图9显示了完整DExNet模型以及没有AES块、没有ACN块、没有PRE块和没有LPN块的DExNet的单图像反射去除结果。

#### 2) 多尺度架构的有效性

所提出的DExNet由S尺度的SAFU模块组成，以模拟多尺度排斥损失并从低分辨率尺度到高分辨率尺度逐步估计透射图像和反射图像。在表VI中，我们通过将每个尺度中的阶段数固定为K = 5来进一步分析DExNet中尺度数S的有效性。

从表中我们可以观察到，通过增加DExNet中的尺度数，模型性能有所提升。此外，计算成本仅边际增加，因为每个低尺度的特征图大小减半。这表明多尺度架构可以有效且高效地整合来自不同尺度的信息并导致更好的性能。

在表VII中，我们通过固定尺度数S = 4显示了每个尺度中不同阶段数的消融研究结果。从表中我们可以看到，通过将阶段数从1增加到5，模型性能几乎线性增加。因此，我们默认设置尺度数S = 4和阶段数K = 5。

#### 3) 损失函数的有效性

我们进行消融研究以分析不同损失函数的有效性。所提出的DExNet利用重建损失 $L_r$、感知损失 $L_p$ 和辅助损失 $L_a$ 进行训练。由于重建损失无法移除，我们专注于分析感知损失和辅助损失的有效性。消融结果显示在表VIII中。

我们可以发现感知损失可以有效地将PSNR性能提高约1.2 dB。这验证了来自VGG网络的特征损失可以帮助改善感知和定量性能。辅助损失可以帮助将PSNR提高约0.6 dB。此外，图10可视化了关于损失函数的消融研究的两个示例。

我们可以看到感知损失可以帮助识别和去除语义上困难的情况，辅助损失可以帮助进一步去除细粒度的反射内容。

## V. 结论

在本文中，我们介绍了深度排斥展开网络（DExNet），这是一种用于单图像反射去除的新颖且轻量级的模型启发网络。所提出的DExNet将简单而准确的图像形成建模和通用排斥先验集成到深度架构中，这使得能够准确的联合反射和透射图像估计以及两个图像层之间的丰富特征交互，以有效减少共同特征的存在。

我们首先将反射去除问题制定为基于模型的卷积稀疏编码问题，该问题进一步包括通用排斥先验以识别和惩罚两个图像层特征之间的共性，从而促进两个图像层的分离。我们的贡献扩展到迭代稀疏和辅助特征更新（i-SAFU）算法的引入。

通过展开和参数化i-SAFU算法，所提出的DExNet使用稀疏和辅助特征更新（SAFU）模块的多个尺度构建，这与迭代算法具有精确的一对一关系，确保基于模型和基于学习方法的无缝集成。

SAFU模块包括三个关键组件：稀疏特征辅助等式（AES）块、辅助特征辅助等式（AEA）块和投影重建误差（PRE）块。这些组件对网络功能至关重要，以边际参数足迹运行。通过结合基于模型和基于学习范式的优点，DExNet在单图像反射去除上实现了最先进的性能。值得注意的是，DExNet以其轻量级特性和增强的可解释性而突出。

在未来，将所提出的DExNet应用和适应到更广泛的盲图像和信号分离任务（如图像去雨、图像去雾和高光谱图像解混）将是非常有趣的。

## 参考文献

[省略详细参考文献列表以节省空间...]

## 作者简介

**Jun-Jie Huang** 于2013年和2015年分别获得香港理工大学电子工程一等荣誉学士学位和电子信息工程硕士学位，2019年获得伦敦帝国理工学院博士学位。他是中国长沙国防科技大学计算机科学与技术学院的副教授。2019-2021年期间，他是伦敦帝国理工学院电气电子工程系通信和信号处理（CSP）组的博士后。他的研究兴趣包括基于模型的深度学习、计算机视觉和信号处理领域。

**Tianrui Liu** 于2019年获得伦敦帝国理工学院（ICL）博士学位。她目前是中国国防科技大学（NUDT）计算机科学系的副教授。在此之前，她是ICL的BioMedIA组的研究助理。她的研究兴趣包括计算机视觉、机器学习和医学图像/视频分析。

**Zihan Chen** 于2023年获得国防科技大学（NUDT）硕士学位。她目前正在NUDT攻读博士学位。她的研究兴趣包括计算机视觉和信息隐藏。

**Xinwang Liu**（IEEE高级会员）获得中国国防科技大学（NUDT）博士学位。他现在是NUDT计算机学院的教授。他目前的研究兴趣包括核学习和无监督特征学习。他已发表70多篇同行评议论文，包括在IEEE模式分析与机器智能汇刊、IEEE知识与数据工程汇刊等高度受重视的期刊和会议上发表的论文。

**Meng Wang**（IEEE会士）于2003年和2008年分别获得中国科学技术大学电子工程与信息科学系少年班学士学位和博士学位。他目前是合肥工业大学教授。他在其研究领域已发表200多篇书籍章节、期刊和会议论文。他目前的研究兴趣包括多媒体内容分析、计算机视觉和模式识别。他是ACM SIGMM新星奖2014的获得者。

**Pier Luigi Dragotti**（IEEE会士）于1997年获得意大利那不勒斯费德里科二世大学电子工程学士学位（最高荣誉），1998年和2002年分别获得瑞士洛桑联邦理工学院（EPFL）通信系统硕士学位和博士学位。他曾担任多个访问职位，目前是伦敦帝国理工学院电气电子工程系信号处理教授。他的研究兴趣包括采样理论及其应用、计算成像和基于模型的深度学习。他是2011年欧洲研究委员会启动研究者奖（consolidator stream）的获得者，也是IEEE SPS杰出讲师（2021-2022）。